type: postgresql
mode: recovery
version:
  postgresql: "16"

nameOverride: immich

recovery:
  method: object_store
  endpointURL: "http://ssd-ha-hl.object-storage.svc:9000"
  clusterName: cnpg-cluster
  secret:
    name: immich-s3-creds
    create: false
  s3:
    bucket: immich-postgresql-backup
    region: ap-northeast-2

cluster:
  instances: 1
  imageName: isac322/pgvectors-vchord:16.10-pgvectors0.3.0-vchord0.5.3
  storage:
    storageClass: ssd-ha-xfs
    size: 10Gi
  postgresql:
    shared_preload_libraries:
      - vectors.so
      - vchord.so
  postgresUID: 26
  postgresGID: 999
  monitoring:
    enabled: true
#  services:
#    additional:
#      - selectorType: rw
#        serviceTemplate:
#          metadata:
#            name: "mydb-lb"
#            labels:
#              test-label: "true"
#            annotations:
#              test-annotation: "true"
#          spec:
#            type: LoadBalancer
backups:
  enabled: false
  endpointURL: "http://ssd-ha-hl.object-storage.svc:9000"
  provider: s3
  data:
    encryption: ''
  wal:
    encryption: ''
  secret:
    create: false
    name: immich-s3-creds
  s3:
    bucket: immich-postgresql-backup
    region: ap-northeast-2
  scheduledBackups:
    - name: daily-backup # Daily at midnight
      schedule: "0 0 0 * * *" # Daily at midnight
      backupOwnerReference: self
  retentionPolicy: "30d"
